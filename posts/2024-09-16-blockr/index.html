<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="David Granjon">
<meta name="dcterms.date" content="2024-09-16">
<title>Introducing blockr: a no-code dashboard builder for R – cynkra blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon-32x32.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<meta name="shinylive:serviceworker_dir" content="../..">
<script src="../../site_libs/quarto-contrib/shinylive-0.8.0/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="../../site_libs/quarto-contrib/shinylive-0.8.0/shinylive/run-python-blocks.js" type="module"></script>
<link href="../../site_libs/quarto-contrib/shinylive-0.8.0/shinylive/shinylive.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="../../site_libs/quarto-diagram/mermaid-postprocess-shim.js"></script><meta name="robots" content="noindex">
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://cynkra.com/" class="navbar-brand navbar-brand-logo">
    <img src="../../logo_light.svg" alt="" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-consulting" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Consulting</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-consulting">
<li>
    <a class="dropdown-item" href="https://cynkra.com/consulting/">
 <span class="dropdown-text">R Consulting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://cynkra.com/workshops/">
 <span class="dropdown-text">Workshops</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://cynkra.com/rmarkdown/">
 <span class="dropdown-text">R Markdown templates</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-solutions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Solutions</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-solutions">
<li>
    <a class="dropdown-item" href="https://cynkra.com/posit-based-enterprise-data-science-environments/">
 <span class="dropdown-text">Enterprise Data Science Environments</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://cynkra.com/cicd-images/">
 <span class="dropdown-text">Container Images</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://cynkra.com/posit/">
 <span class="dropdown-text">Posit Licences</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="https://cynkra.com/opensource"> 
<span class="menu-text">open source</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://cynkra.com/about"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://cynkra.com/blog"> 
<span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Introducing blockr: a no-code dashboard builder for R</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Granjon </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 16, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://avatars.githubusercontent.com/u/145758851?s=400&amp;u=1545a34095e8e84f5cb2b292b1e900df59ba7239&amp;v=4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:25.0%"></p>
</figure>
</div>
<p>Since 2023, <a href="https://www.bms.com/">BristolMyersSquibb</a>, the Y <a href="https://the-y-company.com/">company</a> and <a href="https://cynkra.com">cynkra</a> have teamed up to develop a novel <strong>no-code</strong> solution for R.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bristolmyerssquibb.github.io/blockr">blockr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'blockr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pracma</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>blockr is an R package designed to democratize <strong>data analysis</strong> by providing a <strong>flexible</strong>, <strong>intuitive</strong>, and <strong>code-free</strong> approach to building data pipelines. It has 2 main user targets:</p>
<ol type="1">
<li>On the one hand, it empowers <strong>non technical</strong> users to create insightful data workflows using <strong>pre-built</strong> blocks that can be easily connected, all without writing a single line of code.</li>
<li>On the other hand, it provides developers with a set of tools to seamlessly create new blocks, thereby enhancing the entire framework and fostering <strong>collaboration</strong> within organizations teams.</li>
</ol>
<p>blockr is data <strong>agnostic</strong>, meaning it can work with any kind of dataset, that is pharmaceutical data or sport analytics data. It builds on top of <a href="https://shiny.posit.co/">shiny</a> to ensure real time feedback to any data change. Finally, it allows to export code to create <strong>reproducible</strong> data analysis.</p>
</section><section id="getting-started" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<section id="as-a-simple-user" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="as-a-simple-user">As a simple user</h3>
<p>As a simple user, you’re not expected to write any single line of code to use blockr. You can use the below kitchen sink to get started. This example is based on the palmer penguins data and running a single stack with 3 blocks: the first block to select the data, another one to create the plot and then add the points to it.</p>
<p>blockr has a its own <strong>validation</strong> system. For instance, using the below example, you can try to press return on the first block select box (penguins is the selected default). You’ll notice an immediate feedback message. A global message is displayed in the block upper middle part: “1 error(s) found in this block”. You get more detailed mesages next to the faulty input(s): “selected value(s) not among provided choices”. You can repeat the same experience with the last plot layer block, by emptying the color and shape select inputs. Error messages can accumulate.</p>
<p>You can dynamically add blocks to a current <strong>stack</strong>, that gathers a set of related blocks. You can think a stack as a data analysis <strong>recipe</strong> as in cooking, where blocks are instructions. To add a new block, you can click on the <code>+</code> icon on the stack top right corner. This opens a sidebar on the left side, where one may search for blocks that are compatible with the current state of the pipeline. With an empty stack, only entry point blocks are suggested, so you can import data. Then, after clicking on the block, the suggestion list changes so you can, for instance, filter data or select only a subset of columns, and much more.</p>
<div class="column-page">
<pre class="shinylive-r" data-engine="r"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [viewer]
#| column: screen-inset-shaded
#| viewerHeight: 800
webr::install("blockr", repos = c("https://bristolmyerssquibb.github.io/webr-repos", "https://repo.r-wasm.org"))

library(blockr)
library(palmerpenguins)
library(ggplot2)

new_ggplot_block &lt;- function(col_x = character(), col_y = character(), ...) {

  data_cols &lt;- function(data) colnames(data)

  new_block(
    fields = list(
      x = new_select_field(col_x, data_cols, type = "name"),
      y = new_select_field(col_y, data_cols, type = "name")
    ),
    expr = quote(
      ggplot(mapping = aes(x = .(x), y = .(y)))
    ),
    class = c("ggplot_block", "plot_block"),
    ...
  )
}

new_geompoint_block &lt;- function(color = character(), shape = character(), ...) {

  data_cols &lt;- function(data) colnames(data$data)

  new_block(
    fields = list(
      color = new_select_field(color, data_cols, type = "name"),
      shape = new_select_field(shape, data_cols, type = "name")
    ),
    expr = quote(
      geom_point(aes(color = .(color), shape = .(shape)), size = 2)
    ),
    class = c("geompoint_block", "plot_layer_block", "plot_block"),
    ...
  )
}

stack &lt;- new_stack(
  data_block = new_dataset_block("penguins", "palmerpenguins"),
  plot_block = new_ggplot_block("flipper_length_mm", "body_mass_g"),
  layer_block = new_geompoint_block("species", "species")
)
serve_stack(stack)</code></pre>
</div>
<section id="toward-more-complex-analysis" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="toward-more-complex-analysis">Toward more complex analysis</h4>
<p>Let’s consider this <a href="https://www.kaggle.com/datasets/heesoo37/120-years-of-olympic-history-athletes-and-results?select=athlete_events.csv">dataset</a>, which contains 120 years of olympics athletes data until Rio in 2016. In the below kitchen sink, we first add an upload block:</p>
<ol type="1">
<li>Download the <a href="https://www.kaggle.com/datasets/heesoo37/120-years-of-olympic-history-athletes-and-results?select=athlete_events.csv">dataset</a> file locally.</li>
<li>CLick on <code>Add stack</code>.</li>
<li>Click on the stack <code>+</code> button and search for <code>browser</code>, then select the <code>new_filesbrowser_block</code>.</li>
<li>Uncollapse the stack by click on the top right arrow icon. This makes the upload block file input visible.</li>
<li>Click on <code>File select</code> and select the downloaded file at step 1 (<code>athlete_events.csv</code>).</li>
<li>As we obtain a csv file, we must parse it with a <code>new_csv_block</code>. Repeat step 3 to add the <code>new_csv_block</code>. The table is <code>271116</code> rows and <code>15</code> columns.</li>
<li>Add a <code>new_filter_block</code> and select <code>Sex</code> as column and then <code>F</code> in the values input. We leave the comparison to <code>==</code> and click on the <code>Run</code> button. Notice we now have 74522 rows.</li>
<li>Add a <code>new_mutate_block</code> with the following expression: <code>birth_year = Year - Age</code> (this gives us an approximate birth year). Click on submit.</li>
</ol>
<p>From now on, we leave the first stack as is and will reuse it in other stacks. We want to display the average height distribution for female athletes. Let’s do it below.</p>
<ol start="9" type="1">
<li>Create a new stack by clicking on <code>Add stack</code>.</li>
<li>Add it a <code>new_result_block</code>. This allows to import the data from the first stack (and potentially any stack from the dashboard). If you don’t see any data, select another stack name from the dropdown menu.</li>
<li>Add a <code>new_ggplot_block</code>, leave <code>x</code> as default function and select <code>Height</code> as variable in the columns input.</li>
<li>Add a <code>new_geomhistogram_block</code>. Now we have our distribution plot.</li>
</ol>
<p>Alternatively, you could remove the 2 plot blocks and add a <code>new_summarize_block</code> using <code>mean</code> as function and <code>Height</code> as column (result: 168 cm).</p>
<p>In the following, we create a look-up table to be able to retrieve the athlete names based on their <code>ID</code>.</p>
<ol start="13" type="1">
<li>Create a new stack.</li>
<li>Add a result block to import data from the very first stack.</li>
<li>Add a <code>new_select_block</code> and only select <code>ID</code>, <code>Name</code>, <code>birth_year</code>, <code>Team</code> and <code>Sport</code> as columns.</li>
</ol>
<p>Our goal is now to find which athlete did 2 or more different sports.</p>
<ol start="16" type="1">
<li>Create a new stack.</li>
<li>Add a result block to import data from the very first stack.</li>
<li>Add a <code>new_filter_block</code> , select <code>Medal</code> as column, <code>!=</code> as comparison operator and leave the value empty. Click on run, which will only get athletes with medals.</li>
<li>Add a <code>new_group_by_block</code>, grouping by <code>ID</code> (as some athletes have the same name).</li>
<li>Add a <code>new_summarize_block</code> by choising the function <code>n_distinct</code> applied on the <code>Sport</code> columns.</li>
<li>Add a <code>new_filter_block</code> , select <code>N_DISTINCT</code> as column, <code>&gt;=</code> as comparison operator and set the value to 2. Click on run. This gives us the athletes that are doing 2 sports or more.</li>
<li>Add a <code>new_join_block</code>. Select <code>left_join</code> as join function, select the third stack (lookup table) as join table and <code>ID</code> as column.</li>
<li>Add a <code>new_arrange_block</code> for the <code>birth_year</code> column.</li>
</ol>
<p>As a conclusion, Hjrdis Viktoria Tpel (1904) was the first recorded athlete to compete in 2 different sports, swimming and diving for Sweden. Lauryn Chenet Williams (1984) is the latest for US with Athletics and Bobsleigh. It’s actually quite amazing to see people competing in two quite unrelated sports like swimming and handbain the case of Roswitha Krause.</p>
<div class="column-screen-inset">
<pre class="shinylive-r" data-engine="r"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [viewer]
#| column: screen-inset-shaded
#| viewerHeight: 800
webr::install("blockr", repos = c("https://bristolmyerssquibb.github.io/webr-repos", "https://repo.r-wasm.org"))
webr::install("blockr.ggplot2", repos = c("https://bristolmyerssquibb.github.io/webr-repos", "https://repo.r-wasm.org"))

library(blockr)
library(blockr.ggplot2)

options(shiny.maxRequestSize = 100*1024^2)
do.call(set_workspace, args = list(title = "My workspace"))
serve_workspace(clear = FALSE)</code></pre>
</div>
<p>As an end-user, you are not supposed to write code. As such, if you think anything is missing, you can open an issue <a href="https://github.com/BristolMyersSquibb/blockr/issues">here</a>, or ask any developer you are working with to create new blocks. This leads us to the second part of this blog post … How to use blockr as a developers?</p>
</section></section><section id="as-a-developer" class="level3"><h3 class="anchored" data-anchor-id="as-a-developer">As a developer</h3>
<p>How to install it:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html">pak</a></span><span class="op">(</span><span class="st">"BristolMyersSquibb/blockr"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>blockr can’t provide any single data manipulation or visualization block. That’s the reason why we made it easily <strong>extensible</strong>. You can get an introduction to blockr for developers <a href="https://bristolmyerssquibb.github.io/blockr/articles/blockr.html#blockr-for-developers">here</a>.</p>
<p>In the following, we create an ordinary differential equations solver block using the pracma package. We choose the Lorenz <a href="https://en.wikipedia.org/wiki/Lorenz_system">attractor</a>. With R, equations may be written as:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lorenz</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">parms</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>    Y <span class="op">=</span> <span class="va">parms</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    Z <span class="op">=</span> <span class="op">-</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">parms</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>t</code> is the time, <code>y</code> a vector of solutions and <code>params</code> the various parameters. If you are familiar with <a href="https://cran.r-project.org/web/packages/deSolve/index.html">deSolve</a>, equations are defined with similar functions. For this blog post, we selected pracma as deSolve does not run in shinylive, so you could not see the embedded demonstration.</p>
</section><section id="add-interactivity-with-the-fields" class="level3"><h3 class="anchored" data-anchor-id="add-interactivity-with-the-fields">Add interactivity with the <strong>fields</strong>
</h3>
<p>We want to add interactivity on the 3 different parameters. Hence, we create our new block function with 3 <strong>fields</strong> inside a list. Since the expected values are numbers, we leverage the <code>new_numeric_field</code>. Parameters are only explicitly shown for the first field:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_ode_block</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/numeric_field.html">new_numeric_field</a></span><span class="op">(</span>value <span class="op">=</span> <span class="op">-</span><span class="fl">8</span> <span class="op">/</span> <span class="fl">3</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/numeric_field.html">new_numeric_field</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>    c <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/numeric_field.html">new_numeric_field</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># TBD</span></span>
<span>  <span class="co"># ...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you may imagine, these fields are subsequently translated into shiny inputs, that is <code>numericInput</code> in our example. If you face a situation where you need to implement a custom field, not included in blockr, you can read this <a href="https://bristolmyerssquibb.github.io/blockr/articles/new-field.html">vignette</a>.</p>
</section><section id="create-the-block-expression" class="level3"><h3 class="anchored" data-anchor-id="create-the-block-expression">Create the block expression</h3>
<p>As next step, we <strong>instantiate</strong> our block with the <code>new_block</code> blockr <strong>constructor</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new_block</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fields =</span> fields,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> <span class="fu">quote</span>(<span class="sc">&lt;</span>EXPR<span class="sc">&gt;</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="sc">&lt;</span>CLASSES<span class="sc">&gt;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">submit =</span> <span class="cn">FALSE</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A block is composed of fields, a quoted <strong>expression</strong> which involved fields (to delay the evaluation), somes <strong>classes</strong> which control the block behavior, and extra parameters passed with <code>...</code>. Finally, <code>submit</code> allows to delay the block evaluation by requiring the user to click on a submit button (FALSE by default). This prevents from triggering unwanted intensive computations.</p>
<p>In our example, the expression calls the <code>ode45</code> function. Notice the usage of <code>substitute</code> to inject the <code>lorenz</code> function within the expression. This is necessary since <code>lorenz</code> is defined outside of the expression, and using <code>quote</code> would fail. Fields are invoked with <code>.(field_name)</code>, a rather strange notation, required by <code>bquote</code> to process the expression. It is not mandory to understand this technical underlying detail, but this standard must be respected. You may also notice that some parameters like the initial conditions <code>y0</code> or time values are hardcoded. We leave the reader to transform them into fields, as an exercise:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/new_block.html">new_block</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="va">fields</span>,</span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/ode.html">ode45</a></span><span class="op">(</span></span>
<span>        <span class="va">fun</span>,</span>
<span>        y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        t0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        tfinal <span class="op">=</span> <span class="fl">100</span>,</span>
<span>        parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">.</span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">b</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">lorenz</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># TBD</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="add-the-right-classes" class="level3"><h3 class="anchored" data-anchor-id="add-the-right-classes">Add the right classes</h3>
<p>We give our block 2 classes, namely <code>ode_block</code> and <code>data_block</code>:</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_ode_block</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/numeric_field.html">new_numeric_field</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span> <span class="op">/</span> <span class="fl">3</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/numeric_field.html">new_numeric_field</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>    c <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/numeric_field.html">new_numeric_field</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/new_block.html">new_block</a></span><span class="op">(</span></span>
<span>    fields <span class="op">=</span> <span class="va">fields</span>,</span>
<span>    expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/ode.html">ode45</a></span><span class="op">(</span></span>
<span>          <span class="va">fun</span>,</span>
<span>          y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>          t0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>          tfinal <span class="op">=</span> <span class="fl">100</span>,</span>
<span>          parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">.</span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">b</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">lorenz</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va">...</span>,</span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ode_block"</span>, <span class="st">"data_block"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As explained earlier, they are required to control the block behavior, as blockr is build with <a href="https://adv-r.hadley.nz/s3.html">S3</a>. For instance, <code>data_block</code> have a specific <strong>evaluation</strong> method, to calculate the expression:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">evaluate_block.data_block</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dots.html">...length</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/generate_code.html">generate_code</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/environment.html">new.env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>generate_code</code> processes the block code. <strong>Data</strong> blocks are considered as entry point blocks, as opposed to <strong>transformation</strong> blocks, that operate on data. Therefore, you may easily understand that the evaluation method for a transform block requires to pass the data from the previous block with <code>%&gt;%</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">evaluate_block.block</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dots.html">...length</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">expr</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/generate_code.html">generate_code</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to build a plot block and plot layers blocks, you would have to design a specific evaluate method, that accounts for the <code>+</code> operator required by ggplot2. To learn more about how to create a plot block, you can read this <a href="https://bristolmyerssquibb.github.io/blockr/articles/plot-block.html">article</a>.</p>
</section><section id="demo" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="demo">Demo</h3>
<div class="column-screen-inset">
<pre class="shinylive-r" data-engine="r"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| components: [viewer, editor]
#| column: screen-inset-shaded
#| viewerHeight: 800
webr::install("blockr", repos = c("https://bristolmyerssquibb.github.io/webr-repos", "https://repo.r-wasm.org"))
webr::install("blockr.ggplot2", repos = c("https://bristolmyerssquibb.github.io/webr-repos", "https://repo.r-wasm.org"))

library(blockr)
library(pracma)
library(blockr.ggplot2)

lorenz &lt;- function(t, y, parms) {
  c(
    X = parms[1] * y[1] + y[2] * y[3],
    Y = parms[2] * (y[2] - y[3]),
    Z = -y[1] * y[2] + parms[3] * y[2] - y[3]
  )
}

new_ode_block &lt;- function(...) {
  fields &lt;- list(
    a = new_numeric_field(-8 / 3, -10, 20),
    b = new_numeric_field(-10, -50, 100),
    c = new_numeric_field(28, 1, 100)
  )

  new_block(
    fields = fields,
    expr = substitute(
      as.data.frame(
        ode45(
          fun,
          y0 = c(X = 1, Y = 1, Z = 1),
          t0 = 0,
          tfinal = 100,
          parms = c(.(a), .(b), .(c))
        )
      ),
      list(fun = lorenz)
    ),
    ...,
    class = c("ode_block", "data_block")
  )
}

stack &lt;- new_stack(
  new_ode_block,
  new_ggplot_block(
    func = c("x", "y"),
    default_columns = c("y.1", "y.2")
  ),
  new_geompoint_block
)
serve_stack(stack)</code></pre>
</div>
</section><section id="packaging-new-blocks-the-registry" class="level3"><h3 class="anchored" data-anchor-id="packaging-new-blocks-the-registry">Packaging new blocks: the registry</h3>
<p>In the above example, we define the block on the fly. However, an other outstanding feature of blockr is the <strong>registry</strong>, which you can see as a blocks <strong>supermarket</strong>. From the R side, the registry is an <strong>environment</strong> that can be extended by developers who bring their own blocks packages:</p>
<div class="cell" data-mermaid-theme="default" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewbox="-7.5 -8 953.9765625 685" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="672" id="mermaid-figure-1" height="480"><style>#mermaid-figure-1{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-figure-1 .error-icon{fill:#552222;}#mermaid-figure-1 .error-text{fill:#552222;stroke:#552222;}#mermaid-figure-1 .edge-thickness-normal{stroke-width:2px;}#mermaid-figure-1 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-figure-1 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-figure-1 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-figure-1 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-figure-1 .marker{fill:#333333;stroke:#333333;}#mermaid-figure-1 .marker.cross{stroke:#333333;}#mermaid-figure-1 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-figure-1 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-figure-1 .cluster-label text{fill:#333;}#mermaid-figure-1 .cluster-label span,#mermaid-figure-1 p{color:#333;}#mermaid-figure-1 .label text,#mermaid-figure-1 span,#mermaid-figure-1 p{fill:#333;color:#333;}#mermaid-figure-1 .node rect,#mermaid-figure-1 .node circle,#mermaid-figure-1 .node ellipse,#mermaid-figure-1 .node polygon,#mermaid-figure-1 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-figure-1 .flowchart-label text{text-anchor:middle;}#mermaid-figure-1 .node .label{text-align:center;}#mermaid-figure-1 .node.clickable{cursor:pointer;}#mermaid-figure-1 .arrowheadPath{fill:#333333;}#mermaid-figure-1 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-figure-1 .flowchart-link{stroke:#333333;fill:none;}#mermaid-figure-1 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-figure-1 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-figure-1 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-figure-1 .cluster text{fill:#333;}#mermaid-figure-1 .cluster span,#mermaid-figure-1 p{color:#333;}#mermaid-figure-1 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-figure-1 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-figure-1 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style>
<g><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="10" viewbox="0 0 10 10" class="marker flowchart" id="flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="0" viewbox="0 0 10 10" class="marker flowchart" id="flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="11" viewbox="0 0 10 10" class="marker flowchart" id="flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="-1" viewbox="0 0 10 10" class="marker flowchart" id="flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="12" viewbox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="-1" viewbox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-blockr_custom LE-registry" id="L-blockr_custom-registry-0" d="M324.3125,334.5L332.92578125,334.5C341.5390625,334.5,358.765625,334.5,375.9921875,334.5C393.21875,334.5,410.4453125,334.5,419.05859375,334.5L427.671875,334.5"></path></g><g class="edgeLabels"><g transform="translate(375.9921875, 334.5)" class="edgeLabel"><g transform="translate(-26.6796875, -9)" class="label"><foreignobject height="18" width="53.359375"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="edgeLabel">register</span>
</div>
</foreignobject></g></g></g><g class="nodes"><g transform="translate(420.171875, -8)" class="root"><g class="clusters"><g id="registry" class="cluster default flowchart-label"><rect height="669" width="510.3046875" y="8" x="8" ry="0" rx="0" style=""></rect><g transform="translate(233.80859375, 8)" class="cluster-label"><foreignobject height="18" width="58.6875"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Registry</span>
</div>
</foreignobject></g></g></g><g class="edgePaths"><path marker-end="url(#flowchart-crossEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-filter_reg LE-trash" id="L-filter_reg-trash-0" d="M437.125,66L437.125,71.66666666666667C437.125,77.33333333333333,437.125,88.66666666666667,437.125,140.41666666666666C437.125,192.16666666666666,437.125,284.3333333333333,437.125,330.4166666666667L437.125,376.5"></path></g><g class="edgeLabels"><g transform="translate(437.125, 100)" class="edgeLabel"><g transform="translate(-35.578125, -9)" class="label"><foreignobject height="18" width="71.15625"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="edgeLabel">unregister</span>
</div>
</foreignobject></g></g></g><g class="nodes"><g transform="translate(35.5, 126)" class="root"><g class="clusters"><g id="select_reg" class="cluster default flowchart-label"><rect height="518" width="333.5625" y="8" x="8" ry="0" rx="0" style=""></rect><g transform="translate(131.6484375, 8)" class="cluster-label"><foreignobject height="18" width="86.265625"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Select block</span>
</div>
</foreignobject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(174.78125, 59.5)" id="flowchart-reg_name-28" class="node default default flowchart-label"><rect height="33" width="150.171875" y="-16.5" x="-75.0859375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-67.5859375, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="135.171875"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Name: select block</span>
</div>
</foreignobject></g></g><g transform="translate(174.78125, 142.5)" id="flowchart-reg_descr-29" class="node default default flowchart-label"><rect height="33" width="279.125" y="-16.5" x="-139.5625" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-132.0625, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="264.125"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Description: select columns in a table</span>
</div>
</foreignobject></g></g><g transform="translate(174.78125, 225.5)" id="flowchart-reg_classes-30" class="node default default flowchart-label"><rect height="33" width="283.5625" y="-16.5" x="-141.78125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-134.28125, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="268.5625"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Classes: select_block, tranform_block</span>
</div>
</foreignobject></g></g><g transform="translate(174.78125, 308.5)" id="flowchart-reg_input-31" class="node default default flowchart-label"><rect height="33" width="135.96875" y="-16.5" x="-67.984375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-60.484375, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="120.96875"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Input: data.frame</span>
</div>
</foreignobject></g></g><g transform="translate(174.78125, 391.5)" id="flowchart-reg_output-32" class="node default default flowchart-label"><rect height="33" width="148.40625" y="-16.5" x="-74.203125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-66.703125, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="133.40625"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Output: data.frame</span>
</div>
</foreignobject></g></g><g transform="translate(174.78125, 474.5)" id="flowchart-reg_package-33" class="node default default flowchart-label"><rect height="33" width="128.84375" y="-16.5" x="-64.421875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-56.921875, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="113.84375"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Package: blockr</span>
</div>
</foreignobject></g></g></g></g><g transform="translate(437.125, 49.5)" id="flowchart-filter_reg-34" class="node default default flowchart-label"><rect height="33" width="92.359375" y="-16.5" x="-46.1796875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-38.6796875, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="77.359375"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">Filter block</span>
</div>
</foreignobject></g></g><g transform="translate(437.125, 393)" id="flowchart-trash-35" class="node default default flowchart-label"><rect height="33" width="21.125" y="-16.5" x="-10.5625" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-3.0625, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="6.125"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">‘<i class="fa fa-trash"></i>’</span>
</div>
</foreignobject></g></g></g></g><g transform="translate(-7.5, 285)" class="root"><g class="clusters"><g id="blockr_custom" class="cluster default flowchart-label"><rect height="83" width="324.3125" y="8" x="8" ry="0" rx="0" style=""></rect><g transform="translate(96.7734375, 8)" class="cluster-label"><foreignobject height="18" width="146.765625"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">your_block_package</span>
</div>
</foreignobject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g transform="translate(94.078125, 49.5)" id="flowchart-new_block1-24" class="node default default flowchart-label"><rect height="33" width="102.15625" y="-16.5" x="-51.078125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-43.578125, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="87.15625"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">New block 1</span>
</div>
</foreignobject></g></g><g transform="translate(246.234375, 49.5)" id="flowchart-new_block2-25" class="node default default flowchart-label"><rect height="33" width="102.15625" y="-16.5" x="-51.078125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-43.578125, -9)" style="" class="label"><rect></rect><foreignobject height="18" width="87.15625"><div style="display: inline-block; white-space: nowrap;" data-xmlns="http://www.w3.org/1999/xhtml">
<span class="nodeLabel">New block 2</span>
</div>
</foreignobject></g></g></g></g></g></g></g></svg>
</div>
<p></p>
</div>
</div>
</div>
<p>To get an overview of all available blocks within the blockr core package, we call <code>get_registry</code>:</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/get_registry.html">get_registry</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                 ctor                                  description  category
1       arrange_block                              Arrange columns transform
2           csv_block                           Read a csv dataset    parser
3       dataset_block              Choose a dataset from a package      data
4  filesbrowser_block       Select files on the server file system      data
5        filter_block                       filter rows in a table transform
6      group_by_block                             Group by columns transform
7          head_block               Select n first rows of dataset transform
8          join_block                              Join 2 datasets transform
9          json_block                          Read a json dataset    parser
10       mutate_block                                 Mutate block transform
11          rds_block                           Read a rds dataset    parser
12       result_block Shows result of another stack as data source      data
13       select_block                    select columns in a table transform
14    summarize_block                        summarize data groups transform
15       upload_block                   Upload files from location      data
16          xpt_block                           Read a xpt dataset    parser
                                            classes      input     output
1             arrange_block, transform_block, block data.frame data.frame
2   csv_block, parser_block, transform_block, block     string data.frame
3                  dataset_block, data_block, block       &lt;NA&gt; data.frame
4             filesbrowser_block, data_block, block       &lt;NA&gt;     string
5              filter_block, transform_block, block data.frame data.frame
6            group_by_block, transform_block, block data.frame data.frame
7                head_block, transform_block, block data.frame data.frame
8                join_block, transform_block, block data.frame data.frame
9  json_block, parser_block, transform_block, block     string data.frame
10             mutate_block, transform_block, block data.frame data.frame
11  rds_block, parser_block, transform_block, block     string data.frame
12                  result_block, data_block, block       &lt;NA&gt; data.frame
13             select_block, transform_block, block data.frame data.frame
14          summarize_block, transform_block, block data.frame data.frame
15                  upload_block, data_block, block       &lt;NA&gt;     string
16  xpt_block, parser_block, transform_block, block     string data.frame
   package
1   blockr
2   blockr
3   blockr
4   blockr
5   blockr
6   blockr
7   blockr
8   blockr
9   blockr
10  blockr
11  blockr
12  blockr
13  blockr
14  blockr
15  blockr
16  blockr</code></pre>
</div>
</div>
<p>This function returns a dataframe containing information about blocks such as their constructors, like <code>new_ode_block</code>, the description, the category (data, transform, plot … this is user defined), classes, accepted input, returned output and package.</p>
<p>To register a block we call <code>register_block</code> (or <code>register_blocks</code> for multiple blocks):</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">register_my_blocks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/available_blocks.html">register_block</a></span><span class="op">(</span></span>
<span>    constructor <span class="op">=</span> <span class="va">new_ode_block</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"ode block"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Computed the Lorent attractor solutions"</span>,</span>
<span>    classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ode_block"</span>, <span class="st">"data_block"</span><span class="op">)</span>,</span>
<span>    input <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"data.frame"</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"&lt;YOUR_PACKAGE&gt;"</span>,</span>
<span>    category <span class="op">=</span> <span class="st">"data"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># You can register any other blocks here ...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>where <code>&lt;YOUR_PACKAGE&gt;</code> must be replaced by your real package name.</p>
<p>Within a <code>zzz.R</code> script, you can ensure to register any block when the package loads with a <strong>hook</strong>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">.onLoad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">libname</span>, <span class="va">pkgname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">register_my_blocks</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After the registration, you can check whether the registry is updated, by looking at the ode block:</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">register_my_blocks</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bristolmyerssquibb.github.io/blockr/reference/get_registry.html">get_registry</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">reg</span><span class="op">[</span><span class="va">reg</span><span class="op">$</span><span class="va">package</span> <span class="op">==</span> <span class="st">"&lt;YOUR_PACKAGE&gt;"</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>        ctor                             description category
11 ode_block Computed the Lorent attractor solutions     data
                        classes input     output        package
11 ode_block, data_block, block  &lt;NA&gt; data.frame &lt;YOUR_PACKAGE&gt;</code></pre>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/blog\.cynkra\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Except where otherwise noted, content on this blog is licensed under the <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a> licence.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Blog created with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer><script async="">
    // Author: David Granjon (adapted from Mickaël Canouil)
    // Version: <1.0.0>
    // Description: Change image src depending on body class (quarto-light or quarto-dark)
    // License: MIT
    function isDarkMode() {
      var bodyClass = window.document.body.classList;
      return(bodyClass.contains('quarto-dark'))
    }

    function updateNavbarImage() {
      var navbarImg = window.document.getElementsByClassName('navbar-logo')[0];
      var src = navbarImg.src;
      var newSrc = src;
      if (!isDarkMode() && src.includes('_dark')) {
        newSrc = src.replace('_dark', '_light');
      } else if (isDarkMode() && src.includes('_light')) {
        newSrc = src.replace('_light', '_dark');
      }
      if (newSrc !== src) {
        navbarImg.src = newSrc;
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      const themeToggle = document.getElementsByClassName("quarto-color-scheme-toggle")[0];
      themeToggle.addEventListener("click", function() {
        updateNavbarImage();
      });
      if (isDarkMode()) {
        updateNavbarImage();
      }
    });
</script>


</body></html>