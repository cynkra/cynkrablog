{
  "hash": "19e3b407bfe92e9856783fa4b85b5e0c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate: 2021-03-09\nlayout: post\nimage: banner.jpg\nog_image: og_image.jpg\nauthor: Christoph Sax\ntitle: 'Seasonal Adjustment of Multiple Series'\ncategories:\n- R\n- time-series\n---\n\n\n\nseasonal is an easy-to-use and full-featured R-interface to X-13ARIMA-SEATS,\nthe seasonal adjustment software developed by the United States Census\nBureau.\nThe latest CRAN version of seasonal makes it much easier to adjust multiple time series.\n\n\n<figure>\n<img alt=\"Illustration\" src=\"banner.jpg\" style=\" width: 100%; height: auto\">\n<figcaption>\n  Photo by Meriç Dağlı\n</figcaption>\n</figure>\n\n<br>\n\n[seasonal](http://www.seasonal.website) depends on the [x13binary](https://CRAN.R-project.org/package=x13binary) package to access pre-built\nbinaries of X-13ARIMA-SEATS on all platforms and does not require any manual\ninstallation. To install both packages:\n\n```r\ninstall.packages(\"seasonal\")\n```\n\n`seas` is the core function of the [seasonal](https://cran.r-project.org/package=seasonal) package. By default, `seas` calls\nthe automatic procedures of X-13ARIMA-SEATS to perform a seasonal adjustment\nthat works well in most circumstances:\n\n```r\nseas(AirPassengers)\n```\n\nFor a more detailed introduction, read our [article in the *Journal of\nStatistical Software*](https://doi.org/10.18637/jss.v087.i11).\n\n### Multiple Series Adjusmtent\n\nIn the latest [CRAN version 1.8](https://cran.r-project.org/package=seasonal), it is now possible to seasonally adjust multiple series in a single call to `seas()`.\nThis is done by using the built-in batch mode of X-13. It removes the need for loops or `lapply()` in such cases and finally brings one missing feature of X-13 to seasonal -- the *composite* spec.\n\nMultiple adjustments can be performed by supplying multiple time series as an\n`\"mts\"` object:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(seasonal)\nm <- seas(cbind(fdeaths, mdeaths), x11 = \"\")\nfinal(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          fdeaths  mdeaths\nJan 1974 614.1235 1598.740\nFeb 1974 542.3500 1492.127\nMar 1974 613.5029 1443.238\nApr 1974 591.5725 1694.643\nMay 1974 607.4970 1696.021\nJun 1974 543.8415 1558.886\nJul 1974 597.0745 1663.176\nAug 1974 587.0533 1623.498\nSep 1974 588.2693 1741.394\nOct 1974 735.6666 1735.516\nNov 1974 602.0218 1665.590\nDec 1974 496.3985 1394.097\nJan 1975 564.0055 1560.605\nFeb 1975 591.0320 1708.763\nMar 1975 585.7739 1652.994\nApr 1975 581.5294 1671.265\nMay 1975 537.8055 1588.605\nJun 1975 584.3284 1600.979\nJul 1975 566.4872 1541.099\nAug 1975 617.1197 1623.445\nSep 1975 516.4781 1521.497\nOct 1975 559.0481 1577.200\nNov 1975 561.6315 1602.659\nDec 1975 580.9778 1569.692\nJan 1976 519.8106 1477.855\nFeb 1976 882.3725 2180.616\nMar 1976 674.5057 1744.114\nApr 1976 467.4502 1366.628\nMay 1976 509.7854 1344.809\nJun 1976 553.5233 1434.662\nJul 1976 503.2795 1447.952\nAug 1976 494.2373 1383.932\nSep 1976 529.1840 1453.496\nOct 1976 570.4128 1435.912\nNov 1976 590.4285 1540.551\nDec 1976 587.0971 1572.631\nJan 1977 583.2427 1607.153\nFeb 1977 498.9514 1287.403\nMar 1977 500.4632 1306.324\nApr 1977 569.2076 1685.581\nMay 1977 565.6470 1405.231\nJun 1977 509.3196 1432.968\nJul 1977 548.4062 1414.216\nAug 1977 523.6985 1444.945\nSep 1977 563.3014 1402.720\nOct 1977 495.6653 1427.458\nNov 1977 453.9859 1307.828\nDec 1977 502.3045 1268.618\nJan 1978 535.2658 1415.724\nFeb 1978 633.7605 1790.002\nMar 1978 559.2936 1469.883\nApr 1978 485.5062 1343.715\nMay 1978 590.4080 1509.166\nJun 1978 574.4467 1464.288\nJul 1978 571.2263 1428.398\nAug 1978 542.3579 1424.622\nSep 1978 551.2099 1422.428\nOct 1978 557.6905 1399.404\nNov 1978 479.8979 1199.762\nDec 1978 550.4253 1397.023\nJan 1979 548.9834 1557.853\nFeb 1979 576.9922 1425.717\nMar 1979 549.3468 1393.788\nApr 1979 546.4590 1449.784\nMay 1979 525.9881 1359.843\nJun 1979 550.2481 1330.113\nJul 1979 533.7558 1373.156\nAug 1979 566.6884 1381.653\nSep 1979 552.6500 1377.175\nOct 1979 533.9571 1337.640\nNov 1979 557.9707 1414.101\nDec 1979 475.5049 1038.506\n```\n\n\n:::\n:::\n\n\n\nThis will perform two seasonal adjustments, one for `fdeaths` and one for\n`mdeaths`. X-13 spec-argument combinations can be applied in the usual way, such\nas `x11 = \"\"`. Note that if entered that way, they will apply to both series. The [vignette on multiple adjustments](https://cran.r-project.org/web/packages/seasonal/vignettes/multiple.html) describes how to specify options for individual series.\n\n\n### Backend\n\nX-13 ships with a batch mode that allows multiple adjustments in a single call\nto X-13. This is now the default in seasonal (`multimode = \"x13\"`).\nAlternatively, X-13 can be called for each series (`multimode = \"R\"`).\nThe results should be usually the same, but switching to\n`multimode = \"R\"` may be useful for debugging:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseas(cbind(fdeaths, mdeaths), multimode = \"x13\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$fdeaths\n\nCall:\nseas(x = cbind(fdeaths, mdeaths), multimode = \"x13\")\n\nCoefficients:\n      Constant      AO1976.Feb  MA-Seasonal-12  \n      -0.01578         0.43345         0.63119  \n\n\n$mdeaths\n\nCall:\nseas(x = cbind(fdeaths, mdeaths), multimode = \"x13\")\n\nCoefficients:\n       AO1976.Feb         LS1976.Apr         AO1977.Apr         AO1978.Feb  \n           0.3319            -0.1330             0.1957             0.2305  \n       AO1979.Dec  MA-Nonseasonal-01     MA-Seasonal-12  \n          -0.3149            -0.3854             0.6120  \n\n\n$call\nseas(x = cbind(fdeaths, mdeaths), multimode = \"x13\")\n\nattr(,\"class\")\n[1] \"seas_multi\" \"list\"      \n```\n\n\n:::\n\n```{.r .cell-code}\nseas(cbind(fdeaths, mdeaths), multimode = \"R\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$fdeaths\n\nCall:\nseas(x = cbind(fdeaths, mdeaths), multimode = \"R\")\n\nCoefficients:\n      Constant      AO1976.Feb  MA-Seasonal-12  \n      -0.01578         0.43345         0.63119  \n\n\n$mdeaths\n\nCall:\nseas(x = cbind(fdeaths, mdeaths), multimode = \"R\")\n\nCoefficients:\n       AO1976.Feb         LS1976.Apr         AO1977.Apr         AO1978.Feb  \n           0.3319            -0.1330             0.1957             0.2305  \n       AO1979.Dec  MA-Nonseasonal-01     MA-Seasonal-12  \n          -0.3149            -0.3854             0.6120  \n\n\n$call\nseas(x = cbind(fdeaths, mdeaths), multimode = \"R\")\n\nattr(,\"class\")\n[1] \"seas_multi\" \"list\"      \n```\n\n\n:::\n:::\n\n\n\nIn general, `multimode = \"x13\"` is faster. The following comparison on a MacBook Pro shows\na modest speed gain, but bigger differences have been observed on other systems:\n\n```r\nmany <- rep(list(fdeaths), 100)\nsystem.time(seas(many, multimode = \"x13\"))\n#   user  system elapsed\n#  9.415   0.653  10.079\nsystem.time(seas(many, multimode = \"R\"))\n#   user  system elapsed\n# 11.130   1.039  12.324\n```\n\n### composite spec\n\nSupport for the X-13 batch mode makes it finally possible to use the *composite*\nspec -- the one feature of X-13 that was missing in seasonal. Sometimes, one has to decide whether\nseasonal adjustment should be performed on a granular level or on an aggregated\nlevel. The *composite* spec helps you to analyze the problem and to compare the\ndirect and the indirect adjustments.\n\nThe `composite` argument is a list with an X-13 specification that is applied on\nthe aggregated series. Specification works identically for other series in\n`seas()`, including the application of the defaults. If you provide an empty\nlist, the usual defaults of `seas()` are used.\nA minimal composite call looks like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseas(\n  cbind(mdeaths, fdeaths),\n  composite = list(),\n  series.comptype = \"add\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$mdeaths\n\nCall:\nseas(x = cbind(mdeaths, fdeaths), composite = list(), series.comptype = \"add\")\n\nCoefficients:\n       AO1976.Feb         LS1976.Apr         AO1977.Apr         AO1978.Feb  \n           0.3319            -0.1330             0.1957             0.2305  \n       AO1979.Dec  MA-Nonseasonal-01     MA-Seasonal-12  \n          -0.3149            -0.3854             0.6120  \n\n\n$fdeaths\n\nCall:\nseas(x = cbind(mdeaths, fdeaths), composite = list(), series.comptype = \"add\")\n\nCoefficients:\n      Constant      AO1976.Feb  MA-Seasonal-12  \n      -0.01578         0.43345         0.63119  \n\n\n$composite\n\nCall:\nseas(x = cbind(mdeaths, fdeaths), composite = list(), series.comptype = \"add\")\n\nCoefficients:\n         Constant         AO1976.Feb  MA-Nonseasonal-01     MA-Seasonal-12  \n         -0.03133            0.31247           -0.43509            0.99937  \n\n\n$call\nseas(x = cbind(mdeaths, fdeaths), composite = list(), series.comptype = \"add\")\n\nattr(,\"class\")\n[1] \"seas_multi\" \"list\"      \n```\n\n\n:::\n:::\n\n\n\nYou can verify that the composite refers to the total of `mdeaths` and `fdeaths` by running:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseas(ldeaths)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nseas(x = ldeaths)\n\nCoefficients:\n         Constant         AO1976.Feb  MA-Nonseasonal-01     MA-Seasonal-12  \n         -0.03133            0.31247           -0.43509            0.99937  \n```\n\n\n:::\n:::\n\n\n\nwhere `ldeaths` is the sum of `mdeaths` and `fdeaths`.\n\n\n### Acknowledgement\n\nMany thanks to [Severin Thöni](https://mtec.ethz.ch/people/person-detail.MTU3MzEx.TGlzdC8yODk2LC0yMDgyMjgwMDQ4.html) and [Matthias Bannert](https://kof.ethz.ch/das-institut/personen/person-detail.MTYxMjA1.TGlzdC81NzgsODQ4OTAwOTg=.html), for demonstrating the benefits of the X-13 batch mode. Also to the [ETH KOF](https://kof.ethz.ch), for partially funding this development.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}